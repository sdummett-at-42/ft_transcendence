<!DOCTYPE html>
<html>
<head>
	<title>Canvas de jeu</title>
	<style>
		canvas {
			background-color: gray;
			border: 5px solid black;
		}
	</style>
</head>
<body>
    <button id="startBtn" onclick="startGame()">Start Game</button>
    <br>
	<canvas id="mapGame" width="1200" height="600"> Désolé, votre navigateur ne prend pas en charge &lt;canvas&gt;. </canvas>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <script>
        const socket = io("ws://localhost:3001/game");
		socket.on("connect", function () {
			console.log("Connected to the server");
            const msg = "User have join the game Y has player X.";
            socket.emit("joinGame", msg);
		});


        const mapjeu = document.getElementById('mapGame');
        const ctx = mapjeu.getContext("2d");
        mapjeu.addEventListener("mousemove", updateGame); // catch on mouse's mouvement
        // mapjeu.addEventListener("click", updateGame);

        function updateGame(event) {
            const rect = mapjeu.getBoundingClientRect(); // obtenir la position de l'élément Canvas
            const x = event.clientX - rect.left; // position X de la souris sur l'élément
            const y = event.clientY - rect.top; // position Y de la souris sur l'élément
            console.log("Position de la souris : " + x + ", " + y);

            const data = {x: x, y: y};
            socket.emit("Mouvement", data);
        }

        function startGame() {

			const msg = "Start game from client";
			socket.emit("start", msg);

            // Changer le texte du bouton\
            const startBtn = document.getElementById("startBtn");
            startBtn.innerHTML = "Ce bouton ne sert a rien !";
		}

        socket.on('image', function(data) {
            console.log("image");
            ctx.clearRect(0, 0, mapjeu.width, mapjeu.height);


            ctx.beginPath();


            ctx.arc(data.pos.x, data.pos.y, data.r, 0, 2 * Math.PI);
            ctx.fillStyle = "red";
            ctx.fill();

            console.log(data);
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
	<title>Canvas de jeu</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<style>
		canvas {
			background-color: gray;
			border: 5px solid black;
		}
	</style>
</head>
<body>
    <button id="startBtn" onclick="startGame()">Start Game</button>
    <br>
	<canvas id="mapGame" width="800" height="400"> Désolé, votre navigateur ne prend pas en charge &lt;canvas&gt;. </canvas>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <script>
        const socket = io("ws://localhost:3001/game");
		socket.on("connect", function () {
			console.log("Connected to the server");
            const msg = "User have join the game Y has player X.";
            socket.emit("joinGame", msg);
		});


        const mapjeu = document.getElementById('mapGame');
        const ctx = mapjeu.getContext("2d");
        mapjeu.addEventListener("mousemove", updateGame); // catch on mouse's mouvement
        // mapjeu.addEventListener("click", updateGame);

        function updateGame(event) {
            const rect = mapjeu.getBoundingClientRect(); // obtenir la position de l'élément Canvas
            const x = event.clientX - rect.left; // position X de la souris sur l'élément
            const y = event.clientY - rect.top; // position Y de la souris sur l'élément
            console.log("Position de la souris : " + x + ", " + y);

            const data = {x: x, y: y};
            socket.emit("Mouvement", data);
        }

        function startGame() {

			const msg = "Start game from client";
            // Changer le texte du bouton\
            const startBtn = document.getElementById("startBtn");
            if (startBtn.innerHTML === "Start Game")
            {
                socket.emit("start", msg);
                startBtn.innerHTML = "End Game";
            }
            else if (startBtn.innerHTML === "End Game")
            {
                socket.emit("end", msg);
                startBtn.innerHTML = "Start Game";
            }
		}

        socket.on('image', function(data) {
            console.log("image");
            ctx.clearRect(0, 0, mapjeu.width, mapjeu.height);
            //ctx.beginPath();

            console.log(`size = ${data.length}`);
            console.log(data);
            for (let i = 0; i < data.length; i++)
            {
                ctx.beginPath();
                //console.log(`type is ${data[0].type}`);
                if (data[i].type === "Bullet")
                {
                    console.log("this is bullet");
                    // pos : Coordonnee;   // Coordonnee
                    // r : number;         // size of radius
                    // v : number;         // speed
                    // a : number;         // direction
                    ctx.fillStyle = "red"; // a remplacer par couleur objet
                    ctx.arc(data[i].pos.x, data[i].pos.y, data[i].r, 0, 2 * Math.PI);
                    ctx.fill();
                }
                else if (data[i].type === "Circle")
                {
                    console.log("this is Circle");
                    ctx.strokeStyle = "blue";
                    ctx.arc(data[i].pos.x, data[i].pos.y, data[i].r, 0, 2 * Math.PI);
                    //ctx.fill();
                    ctx.stroke();
                }
                else if (data[i].type === "BlackHole")
                {
                    console.log("this is BlackHole");
                    ctx.strokeStyle = "Black";
                    ctx.arc(data[i].pos.x, data[i].pos.y, data[i].r, 0, 2 * Math.PI);
                    ctx.stroke();
                }
                else if (data[i].type === "Square")
                {
                    console.log("this is saqure");
                    ctx.fillStyle = "green";
                    ctx.fillRect(data[i].pos.x, data[i].pos.y, data[i].width, data[i].length);
                    ctx.fill();
                }
            }

            console.log(data);
        });
    </script>
</body>
</html>